name: ğŸš€ è‡ªåŠ¨åŒ–éƒ¨ç½²å·¥ä½œæµ

on:
    workflow_dispatch:
        inputs:
            reason:
                description: 'ğŸ“ è¯·è¾“å…¥æœ¬æ¬¡æ‰‹åŠ¨éƒ¨ç½²çš„åŸå›  (å¯é€‰)'
                required: false
                default: 'æ‰‹åŠ¨è§¦å‘éƒ¨ç½²'

    push:
        branches:
            - main

jobs:
    build-and-deploy:
        runs-on: ubuntu-latest
        name: ğŸš€ è‡ªåŠ¨éƒ¨ç½²
        steps:
            # 1. è·å–æ‚¨çš„é¡¹ç›®æºç  â¬‡ï¸
            - name: Checkout ä»£ç  ğŸ“‚
              uses: actions/checkout@v4

            # 2. é…ç½® Node.js è¿è¡Œç¯å¢ƒ ğŸ› ï¸
            - name: è®¾ç½® Node.js ç¯å¢ƒ (ç‰ˆæœ¬ 22) âš™ï¸
              uses: actions/setup-node@v4
              with:
                  node-version: 'lts/jod'

            # 3. å®‰è£…ä¾èµ–å¹¶ç”Ÿæˆç½‘ç«™é™æ€æ–‡ä»¶ ğŸ—ï¸
            - name: å®‰è£…ä¾èµ– & ç”Ÿæˆ Hexo é™æ€æ–‡ä»¶ ğŸ“„
              run: |
                  echo "â¡ï¸ æ­¥éª¤ 1/3: æ­£åœ¨å®‰è£…é¡¹ç›®ä¾èµ–ï¼Œè¯·ç¨å€™... â³"
                  npm i # ä¿æŒåŸæœ‰å‘½ä»¤ 'npm i'
                  echo "âœ… é¡¹ç›®ä¾èµ–å®‰è£…å®Œæˆï¼"

                  echo "â¡ï¸ æ­¥éª¤ 2/3: æ­£åœ¨å…¨å±€å®‰è£… Hexo CLI å·¥å…·... ğŸ”—"
                  npm install hexo-cli -g # ä¿æŒåŸæœ‰å‘½ä»¤ 'npm install hexo-cli -g'
                  echo "âœ… Hexo CLI å®‰è£…å®Œæˆï¼"

                  echo "â¡ï¸ æ­¥éª¤ 3/3: æ­£åœ¨æ¸…ç†å¹¶ç”Ÿæˆ Hexo é™æ€æ–‡ä»¶... âœ¨"
                  hexo clean && hexo generate # ä¿æŒåŸæœ‰å‘½ä»¤ 'hexo clean && hexo generate'
                  echo "ğŸ‰ ç½‘ç«™é™æ€æ–‡ä»¶å·²æˆåŠŸç”Ÿæˆåˆ° public/ ç›®å½•ï¼"

            # 4. éƒ¨ç½²ç”Ÿæˆçš„é™æ€æ–‡ä»¶åˆ°æ‚¨çš„è¿œç¨‹æœåŠ¡å™¨ ğŸ“¤
            - name: éƒ¨ç½²é™æ€æ–‡ä»¶åˆ°è¿œç¨‹æœåŠ¡å™¨ ğŸš€
              uses: easingthemes/ssh-deploy@main
              with:
                  SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
                  ARGS: '-rltgoDzvO --delete'
                  EXCLUDE: '.well-known, .user.ini'
                  SOURCE: public/
                  REMOTE_HOST: ${{ secrets.REMOTE_HOST }}
                  REMOTE_PORT: ${{ secrets.REMOTE_PORT }}
                  REMOTE_USER: ${{ secrets.REMOTE_USER }}
                  TARGET: ${{ secrets.DEPLOY_DIR }}
